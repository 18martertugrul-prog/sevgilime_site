<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AÅŸk Flappy ðŸ’–</title>

<style>
body{
    margin:0;
    overflow:hidden;
    background:#87CEEB;
}

canvas{
    display:block;
    margin:auto;
    background:linear-gradient(#87CEEB,#ffe6f2);
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<audio id="bgMusic" src="bgmusic.mp3" loop></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 400;
canvas.height = 700;

/* ===================== */
/* SABÄ°T MEKANÄ°KLER */
/* ===================== */

const GRAVITY = 0.3025;
const JUMP = -6.2;
const MAX_FALL = 7;

let basePipeSpeed = 2.057;
let currentPipeSpeed = basePipeSpeed;

const PIPE_GAP = 195;
const PIPE_WIDTH = 60;
const PIPE_DISTANCE_PX = 260;
const GROUND_HEIGHT = 80;

/* ===================== */
/* PARALLAX */
/* ===================== */

let cloudX1 = 0;
let cloudX2 = 200;

/* ===================== */
/* KUÅž */
/* ===================== */

let bird = {
    x: 90,
    y: 350,
    radius: 18,
    velocity: 0,
    rotation: 0,
    wingUp:true
};

let pipes = [];
let hearts = [];
let score = 0;
let gameOver = false;
let lastTime = 0;

/* ===================== */
/* MÃœZÄ°K */
/* ===================== */

document.addEventListener("click",()=>{
    document.getElementById("bgMusic").play();
},{once:true});

/* ===================== */
/* KONTROL */
/* ===================== */

function jump(){
    if(!gameOver){
        bird.velocity = JUMP;
        bird.rotation = -20;
    }else{
        restart();
    }
}

document.addEventListener("keydown",e=>{
    if(e.code==="Space") jump();
});
canvas.addEventListener("touchstart",jump);

/* ===================== */
/* BORU */
/* ===================== */

function createPipe(){
    let min = 80;
    let max = canvas.height - PIPE_GAP - GROUND_HEIGHT - 80;
    let topHeight = Math.random()*(max-min)+min;

    pipes.push({
        x: canvas.width,
        top: topHeight,
        passed:false
    });

    hearts.push({
        x: canvas.width + PIPE_WIDTH/2,
        y: topHeight + PIPE_GAP/2,
        collected:false
    });
}

/* ===================== */
/* Ã‡Ä°ZÄ°MLER */
/* ===================== */

function drawBackground(delta){
    cloudX1 -= 0.3 * delta;
    cloudX2 -= 0.2 * delta;

    if(cloudX1 < -100) cloudX1 = 400;
    if(cloudX2 < -100) cloudX2 = 400;

    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.arc(cloudX1,100,30,0,Math.PI*2);
    ctx.arc(cloudX1+40,100,30,0,Math.PI*2);
    ctx.fill();

    ctx.beginPath();
    ctx.arc(cloudX2,200,25,0,Math.PI*2);
    ctx.arc(cloudX2+35,200,25,0,Math.PI*2);
    ctx.fill();
}

function drawBird(){
    ctx.save();
    ctx.translate(bird.x,bird.y);
    ctx.rotate(bird.rotation*Math.PI/180);

    ctx.fillStyle="#ffcc00";
    ctx.beginPath();
    ctx.arc(0,0,bird.radius,0,Math.PI*2);
    ctx.fill();

    ctx.fillStyle="#ffaa00";
    ctx.beginPath();
    if(bird.wingUp){
        ctx.ellipse(-5,5,8,15,0,0,Math.PI*2);
    }else{
        ctx.ellipse(-5,15,8,15,0,0,Math.PI*2);
    }
    ctx.fill();

    bird.wingUp = !bird.wingUp;

    ctx.restore();
}

function drawPipes(){
    pipes.forEach(pipe=>{
        ctx.fillStyle="#2ecc71";
        ctx.fillRect(pipe.x,0,PIPE_WIDTH,pipe.top);

        let bottomY = pipe.top + PIPE_GAP;
        ctx.fillRect(pipe.x,bottomY,PIPE_WIDTH,canvas.height-bottomY-GROUND_HEIGHT);
    });
}

function drawGround(){
    ctx.fillStyle="#8b5a2b";
    ctx.fillRect(0,canvas.height-GROUND_HEIGHT,canvas.width,GROUND_HEIGHT);
}

function drawHearts(){
    hearts.forEach(h=>{
        if(!h.collected){
            ctx.fillStyle="red";
            ctx.beginPath();
            ctx.arc(h.x-5,h.y,5,0,Math.PI*2);
            ctx.arc(h.x+5,h.y,5,0,Math.PI*2);
            ctx.lineTo(h.x,h.y+10);
            ctx.fill();
        }
    });
}

/* ===================== */
/* GAME LOOP */
/* ===================== */

function update(timestamp){

    let delta = (timestamp-lastTime)/16.67;
    lastTime = timestamp;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawBackground(delta);

    if(pipes.length===0 || canvas.width - pipes[pipes.length-1].x >= PIPE_DISTANCE_PX){
        createPipe();
    }

    if(!gameOver){
        bird.velocity += GRAVITY * delta;
        if(bird.velocity > MAX_FALL) bird.velocity = MAX_FALL;
        bird.y += bird.velocity * delta;

        if(bird.velocity > 0){
            bird.rotation += 3 * delta;
            if(bird.rotation>90) bird.rotation=90;
        }
    }

    pipes.forEach(pipe=>{
        pipe.x -= currentPipeSpeed * delta;

        if(!pipe.passed && pipe.x + PIPE_WIDTH < bird.x){
            score++;
            pipe.passed=true;
            currentPipeSpeed += 0.08;
        }
    });

    hearts.forEach(h=>{
        h.x -= currentPipeSpeed * delta;

        if(!h.collected){
            let dx = bird.x - h.x;
            let dy = bird.y - h.y;
            if(Math.sqrt(dx*dx+dy*dy) < bird.radius+8){
                h.collected=true;
                score+=2;
            }
        }
    });

    drawPipes();
    drawHearts();
    drawGround();
    drawBird();

    ctx.fillStyle="#000";
    ctx.font="24px Arial";
    ctx.fillText("Skor: "+score,20,40);

    requestAnimationFrame(update);
}

function restart(){
    pipes=[];
    hearts=[];
    score=0;
    currentPipeSpeed=basePipeSpeed;
    bird.y=350;
    bird.velocity=0;
    gameOver=false;
}

requestAnimationFrame(update);

</script>
</body>
</html>
